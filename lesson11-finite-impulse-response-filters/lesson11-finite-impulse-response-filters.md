# 前言
FIR滤波器是使用Z变换对信号进行处理的一种滤波器，移动平均滤波器是一种简单的 FIR 滤波器。本章首先介绍FIR滤波器，然后介绍移动平均滤波器，最后介绍FIR滤波器的应用。
# FIR滤波器
## 定义和结构
### 定义：
对于有限脉冲响应（FIR）滤波器，假设输入信号为$x[n]$，输出信号为$y[n]$，其定义为$$y[n]=\sum_{k = 0}^{M - 1}b_k x[n - k]$$
这里的$b_k$是滤波器系数，它决定了滤波器对不同时刻输入信号的加权程度；$M$为滤波器阶数，它表示参与滤波运算的输入信号样本的数量范围。

比如说，如果$M = 5$，那么在计算$y[n]$时，就会用到$x[n]$、$x[n - 1]$、$x[n - 2]$、$x[n - 3]$、$x[n - 4]$这五个样本值，分别乘以对应的滤波器系数$b_0$、$b_1$、$b_2$、$b_3$、$b_4$，然后将这些乘积相加得到输出$y[n]$。

从时域来看，FIR 滤波器是对输入信号的一系列延时样本进行加权求和得到输出信号。从频域来看，FIR 滤波器通过对输入信号的频谱进行加权处理来实现滤波功能。
### 结构：
从结构上来看，FIR滤波器是一种线性时不变系统，它由一系列的乘法器、加法器和单位延迟等基本元件构成。
# 移动平均滤波器
## 工作原理：
移动平均滤波器的定义为$$y[n]=\frac{1}{M}(x[n]+x[n + 1]+\cdots+x[n + M - 1])$$
它的工作原理是对输入信号$x[n]$的连续$M$个样本值进行求和，然后取平均值作为当前时刻$n$的输出$y[n]$。

比如说，我们有一个输入信号序列$x[n]$，当我们要计算$y[3]$（假设$M = 5$）时，就会把$x[3]$、$x[4]$、$x[5]$、$x[6]$、$x[7]$这五个连续的样本值相加，再除以$5$，得到的结果就是$y[3]$。

随着$n$的不断变化，这个“窗口”（也就是参与求和平均的这$M$个样本）会不断地在输入信号序列上移动，依次计算出每个时刻的输出值，所以叫做移动平均滤波器。
## 滤波效果：
通过一个简单的输入输出信号示例来看它的滤波效果。假设输入信号$x[n]$是一个包含了一些随机波动的近似正弦波信号，比如：
$$x[n]=\sin(2\pi\cdot(0.1)\cdot n)+0.5\cdot \text{random}[-1,1]$$（这里$\text{random}[-1,1]$表示在$-1$到$1$之间的随机数）。

当我们使用移动平均滤波器（假设$M = 3$）对其进行滤波时，对于每个时刻$n$，按照上述公式计算输出$y[n]$。可以发现，输出信号$y[n]$相比输入信号$x[n]$，那些随机波动的部分被明显地平滑掉了。原本输入信号上因为随机数加入而产生的“毛刺”不见了，整体呈现出更接近正弦波的平滑曲线，这就是移动平均滤波器的滤波效果，它能够对信号起到平滑的作用，去除一些小的波动和噪声干扰。
# DSP系统基本构建元件及FIR滤波器构成
## 乘法器：
在FIR滤波器中，乘法器的作用是将输入信号的每个样本值（如$x[n - k]$）与对应的滤波器系数（$b_k$）相乘。通过乘法运算，根据滤波器系数赋予每个输入样本不同的权重，从而实现对输入信号不同成分的有选择性的放大或衰减。

例如，若$b_0 = 2$，当输入信号为$x[n]$时，经过乘法器与$b_0$相乘后，得到的值就是$2x[n]$，这个值就带着$b_0$所设定的权重进入后续的运算。
## 加法器：
加法器的任务是将经过乘法器加权后的各个输入信号样本值相加。在FIR滤波器的计算公式$y[n]=\sum_{k = 0}^{M - 1}b_k x[n - k]$中，就是把所有乘法器输出的乘积结果进行求和，得到最终的输出信号$y[n]$。

比如，经过前面乘法器运算得到了$b_0 x[n]$、$b_1 x[n - 1]$、$b_2 x[n - 2]$等，加法器就把这些值全部加起来，形成完整的滤波输出。
# 单位延迟：
单位延迟元件在FIR滤波器中用于提供不同时刻的输入信号样本。它使得在计算输出信号$y[n]$时，能够获取到之前时刻的输入信号（如$x[n - 1]$、$x[n - 2]$等）。

例如，当我们要计算$y[3]$时，通过单位延迟元件，我们可以得到$x[2]$（即$x[3 - 1]$）、$x[1]$（即$x[3 - 2]$）等之前时刻的输入信号，以便按照FIR滤波器的公式进行完整的运算。

**通过系统方框图展示FIR滤波器的构成：**

在系统方框图中，输入信号$x[n]$首先进入一系列的乘法器，每个乘法器对应一个滤波器系数$b_k$，将输入信号与相应系数相乘。然后这些乘法器的输出进入加法器进行求和，得到输出信号$y[n]$。在这个过程中，单位延迟元件为乘法器提供不同时刻的输入信号样本，保证了能够按照FIR滤波器的定义进行准确的运算。
# FIR滤波器应用
## 移动平均滤波作为FIR滤波器的应用
### 系数特点及滤波效果：
移动平均滤波器是最简单的FIR滤波器形式。它的系数特点是所有的系数$b_k$都相等，且都为$\frac{1}{M}$（在$y[n]=\frac{1}{M}(x[n]+x[n + 1]+\cdots+x[n + M - 1])$这个公式中体现）。

这种系数特点决定了它的滤波效果主要是对输入信号进行平滑处理。因为它对连续的$M$个输入样本同等加权求和平均，所以能够有效地去除输入信号中的一些小波动和高频噪声，使输出信号呈现出更平滑的曲线，就像我们前面在介绍移动平均滤波器工作原理和滤波效果时所举例展示的那样。
### 在信号处理中的优势：
移动平均滤波器在信号处理中有几个明显的优势。

首先，它的计算简单。只需要进行简单的加法和除法运算，不需要复杂的乘法运算（除了最初确定每个样本的系数$\frac{1}{M}$），所以计算速度相对较快，在实时处理信号时能够快速地给出滤波后的结果。

其次，它对信号的平滑效果比较直观且易于理解。通过简单地调整窗口大小（也就是$M$的值），就可以很容易地控制滤波的程度。例如，当$M$增大时，平滑效果会更加明显，因为参与平均的样本更多，能更好地去除波动；但同时也可能会导致信号的一些细节丢失，所以可以根据具体需求灵活调整$M$的值。

最后，它是一种线性滤波器，具有线性滤波器的一些优良特性，比如满足线性叠加原理等，这使得它在处理多个信号或者对信号进行多次滤波等操作时，能够按照线性规律进行处理，便于分析和预测滤波后的结果。
## 股价趋势分析应用——以台积电股价数据为例
假设我们有台积电一段时间内的股价数据作为输入信号$x[n]$，这里的$n$可以表示每天或者每个交易时段等时间单位。股价数据通常会受到各种因素的影响，呈现出复杂的波动情况，既有短期的小波动，也有长期的趋势变化。

当我们应用FIR滤波器（如移动平均滤波器）来分析股价趋势时，比如我们选择移动平均滤波器且设定$M = 10$（这里$M$的选择可以根据具体分析需求和数据特点进行调整）。

按照移动平均滤波器的公式$$y[n]=\frac{1}{M}(x[n]+x[n + 1]+\cdots+x[n + M - 1])$$
对股价数据进行滤波处理。得到的输出信号$y[n]$就可以看作是经过平滑处理后的股价趋势线。

通过观察这条趋势线，我们可以更清晰地看到股价的长期走势，去除了一些短期的小波动干扰。例如，如果股价在短期内因为某个突发新闻或者小的市场波动而出现上下跳动，但经过移动平均滤波器处理后，这些小波动被平滑掉了，我们能更清楚地看到股价是处于上升、下降还是相对平稳的长期趋势中，从而提取出有用的信息，比如判断股价的整体走势方向，为投资决策提供参考。
# 归零滤波器（陷波滤波器）
## 定义及设计目的：
归零滤波器，也叫陷波滤波器，它的定义是专门用于消除特定频率的滤波器。其设计目的就是要在输入信号中去除某个或某些特定频率的成分，而让其他频率成分尽可能不受影响地通过。

## 设计方法及滤波效果：
通过一个具体的设计实例来详细介绍。假设我们要消除干扰信号$$x(t)=\cos(2\pi\cdot(10)\cdot t)+\cos(2\pi\cdot(20)\cdot t)$$中的$20Hz$干扰信号（这里假设时间$t$以秒为单位，所以$20Hz$对应的角频率就是$2\pi\cdot(20)\cdot t$）。

首先，我们需要确定滤波器的系数$b_k$和阶数$M$等参数来设计归零滤波器。对于消除特定频率的陷波滤波器，其设计通常基于对要消除频率的相关数学分析和滤波器设计理论。

一般来说，我们可以通过一些特定的公式和方法来计算出合适的滤波器系数，使得滤波器在频域上对要消除的频率（这里是$20Hz$）呈现出很低的响应，而对其他频率保持相对正常的响应。

经过设计并应用归零滤波器对上述干扰信号进行滤波后，我们可以观察到滤波效果。在输出信号中，原本存在的$20Hz$的余弦波成分（即$\cos(2\pi\cdot(20)\cdot t)$）被大大削弱甚至几乎完全消除了，而$10Hz$的余弦波成分（即$\cos(2\pi\cdot(10)\cdot t)$）基本不受影响，仍然保留在输出信号中，这样就达到了我们消除特定频率干扰信号的目的。