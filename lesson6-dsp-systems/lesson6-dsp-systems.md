# 前言
本章节将我们将学习到到DSP系统的基本概念，几种常见的系统，纯量的运算，以及如何进行采样率的转换，最后我们会在前文介绍WAV文件的基础上，继续补充WAV文件中的DSP技术应用。
# 基本概念
## DSP系统
数字信号处理（DSP）系统是一种对数字信号进行特定转换操作，并且得到期望输出的系统。其输入为数字信号$x[n]$，输出为$y[n]$，两者之间的关系可表示为$$y[n]=T\{x[n]\}$$
这里的$T\{\cdot\}$代表系统所执行的转换操作，这个转换操作可以是各种复杂的数学运算、逻辑判断以及各种信号处理算法的组合。

例如，在音频处理中，输入的数字音频信号可能经过DSP系统的处理，实现音量调节、降噪、音效添加等功能，最终输出处理后的音频信号供播放或进一步分析。
## 系统分类
### 静态系统（无记忆系统）
静态系统，也称为无记忆系统，其特点是输出仅取决于当前输入信号。也就是说，系统在生成输出信号时，不会考虑之前或之后的输入信号状态。例如，一个简单的纯量乘法运算系统$$y[n]=\alpha x[n]$$（其中$\alpha$为缩放因子）就属于静态系统。

在这个系统中，对于每一个时刻$n$的输出$y[n]$，仅仅由当前时刻的输入$x[n]$与缩放因子$\alpha$相乘得到，与其他时刻的输入信号毫无关系。这种系统在处理一些实时性要求较高且不需要考虑信号历史信息的场景中较为常用。
### 动态系统（记忆系统）
与静态系统相反，动态系统（记忆系统）在计算输出时会包含过去、现在和未来的数字信号。这类系统能够利用信号在不同时刻的信息来生成输出，通常用于处理那些具有时间相关性或需要根据历史数据进行预测、分析的信号。动态系统功能实现往往需要借助一些存储机制来保存过去的信号数据，并通过复杂的算法来分析和利用过去的信号数据数据，以及当前和未来的输入信号，从而生成合适的输出信号。例如，在语音识别系统中，为了准确识别出语音内容，不仅要考虑当前时刻输入的语音信号特征，还需要结合之前若干时刻的语音信号信息，甚至可能会对未来一小段时间内的语音信号变化进行预估，以便更好地理解整个语音语句的语义和语调等信息。
### 线性系统
线性系统的运算方式符合线性原则，即对于任意两个输入信号$x_1[n]$和$x_2[n]$以及任意常数$\alpha$和$\beta$，都满足$$T\{\alpha x_1[n]+\beta x_2[n]\}=\alpha T\{x_1[n]\}+\beta T\{x_2[n]\}$$
这个性质使得线性系统在分析和处理上具有很多便利之处。如果一个音频处理系统是线性的，那么我们可以分别对每个音频信号进行单独的处理（如音量调节、滤波等），然后再将处理后的信号按照一定的比例进行叠加，产生的结果与先将原始音频信号按照相同比例叠加，再进行整体处理是相同的。线性系统的这种可叠加性和齐次性特点，使得我们可以通过分析简单输入信号的响应来推断出复杂输入信号的响应，简化了系统分析和设计的过程。
### 非线性系统
与线性系统不同，因为非线性系统处理结果与输入信号之间的关系更为复杂和多样化，导致非线性系统对于输入信号的处理结果不能简单地通过线性叠加和齐次性来预测，往往需要通过具体的实验、模拟或复杂的数学模型来分析其行为和性能。例如，在音频处理中，一些特殊的音效处理，如失真效果处理，就属于非线性系统的应用。
### 时间不变性系统
时间不变性系统的运算方式不随时间改变。具体来说，如果对于某个输入信号$x[n]$，系统的输出为$$y[n]=T\{x[n]\}$$
那么当输入信号变为$$x[n - n_0]$$（即输入信号在时间上延迟了$n_0$个单位）时，系统的输出为$$y[n - n_0]=T\{x[n - n_0]\}$$
这意味着系统对于输入信号的处理效果与输入信号出现的时间无关，无论输入信号是在当前时刻还是在过去或未来的某个时刻，只要输入信号的本身特性不变，系统对其的处理方式和结果都相同。例如，一个简单的滤波系统，如果它是时间不变性系统，那么无论何时输入一个特定频率的音频信号，经过滤波后的输出信号的频率特性和幅度特性等都将保持一致，不会因为输入信号的时间不同而发生变化。
### 时变性系统
时变性系统的运算方式随时间改变。与时间不变性系统相反，这类系统对于相同特性的输入信号，其处理结果会因输入信号出现的时间不同而有所不同。例如，在无线通信系统中，由于信道的时变特性（如信号传播过程中的多径效应、衰落等），接收端对发送端发送的信号进行处理时，处理方式和结果会随着时间不断变化。
### 因果系统
因果系统的输出仅根据当前与过去的数字信号运算。也就是说，系统在生成输出信号时，不会用到未来的输入信号信息。例如，在音频播放系统中，当前播放的声音是根据已经接收到的音频数据（即过去和当前的输入信号）进行处理和播放的，不可能根据还未接收到的未来音频数据来生成当前的播放声音。
### 非因果系统
非因果系统的输出会纳入未来的数字信号进行运算。虽然这种系统在现实世界中不太符合常规的物理逻辑，但在某些理论研究和特定的信号处理场景中也有其应用价值。在一些预测性的数据分析模型中，可能会假设已知未来的部分数据信息，并根据这些未来数据以及当前和过去的输入信号来生成输出信号。非因果系统在实际应用中需要谨慎使用，因为其结果往往依赖于一些不太现实的假设条件。
### 稳定系统
稳定系统具有限制输入 - 限制输出（BIBE）特性，即对于有界的输入信号，系统能够产生有界的输出信号。这意味着无论输入信号的波动范围有多大，只要它是有界的（即存在上下限），经过系统处理后，输出信号也会在一定的范围内波动，不会出现无限增长或无规律的发散情况。例如，在音频处理中，一个稳定的音量调节系统，无论输入的音频信号音量大小如何变化（在合理的有界范围内），经过系统调节后，输出的音频信号音量也会在一个可接受的合理有界范围内，不会出现音量突然变得极大或极小的情况。不稳定系统则不具备此特性，对于某些输入信号，可能会产生无限增长或无规律的发散输出信号，这在实际应用中通常是不可接受的，因为它会导致系统故障或无法正常运行。
# 基本运算
## 纯量乘法
纯量乘法是一种基本的DSP运算，其表达式为$$y[n]=\alpha x[n]$$（其中$\alpha$为缩放因子）。

通过这个运算，可以实现对输入数字信号的幅度缩放。

例如，当$\alpha > 1$时，输出信号的幅度会比输入信号的幅度大，起到放大的作用；当$\alpha < 1$时，输出信号的幅度会比输入信号的幅度小，起到缩小的作用。在音频处理中，纯量乘法常用于调节音量大小，通过改变缩放因子$\alpha$的值，可以轻松地将音频信号的音量调高或调低，以满足不同的听觉需求。
## 加法/减法
加法/减法运算在DSP中也是常见的基本运算，其表达式为$$y[n]=x_1[n]\pm x_2[n]$$
这种运算可以用于将两个或多个数字信号进行合并或相减操作。

例如，在音频混合中，将两个不同的音频信号$$x_1[n]$和$x_2[n]$$通过加法运算进行混合，就可以得到一个新的音频信号$$y[n]=x_1[n]+x_2[n]$$，这个新的音频信号包含了原来两个音频信号的特征。

同样，通过减法运算可以实现从一个音频信号中减去另一个音频信号的效果，比如在音频编辑中，要去除某段音频中的背景噪音，可以将原始音频信号作为$x_1[n]$，将估计的背景噪音信号作为$x_2[n]$，然后通过减法运算$$y[n]=x_1[n]-x_2[n]$$来获取去除噪音后的音频信号。
## 乘法
乘法运算在DSP中的表达式为$$y[n]=x_1[n]\cdot x_2[n]$$
这种运算可以用于多种目的，比如在音频处理中，将一个音频信号与一个系数相乘，可以实现对音频信号的某种特定效果处理。
## 时间延迟
时间延迟运算在DSP中的表达式为$$y[n]=x[n - n_0]$$（其中$n_0$为延迟量）。

通过这个运算，可以使输入信号在时间轴上产生延迟效果。例如，在音频处理中，当我们对一个音频信号施加时间延迟时，会听到声音在时间上往后推迟了相应的时间量。假设我们有一个简单的正弦波音频信号$$x[n]=A\sin(\omega n)$$
当我们对其施加一个时间延迟量$n_0 = 10$（这里假设$n$以某种合适的时间单位计量），那么经过时间延迟运算后的输出信号为$$y[n]=x[n - 10]=A\sin(\omega (n - 10))$$
在听觉上，我们会听到原本连续的正弦波声音在播放到一定时间后，突然往后推迟了一定的时间间隔。
# 采样率转换
## 下采样（抽取）
下采样，也称为抽取，是一种降低数字信号采样率的操作。其目的是在不丢失过多重要信息的前提下，减少数据量，提高处理效率或节省存储空间。常见的下采样方式有以下两种：
1. 简单抽取：每$M$个样本抽取一个。例如，对于一个原始采样率为$f_s$的数字信号，我们设定$M = 5$，那么经过简单抽取后的采样率就变为$\frac{f_s}{5}$。在这个过程中，我们只保留每$5$个样本中的第$1$个样本，其余样本都被丢弃。这种方式简单直接，但是当原始信号变化较快时，可能会导致一定程度的信息丢失。
2. 平均抽取：采用平均值抽取的方式。还是以原始采样率为$f_s$的数字信号为例，我们先将原始信号按照一定的分组方式分成若干组，每组包含$M$个样本（假设$M = 5$），然后计算每组的平均值，将这个平均值作为下采样后新的样本值。这种方式相对简单抽取来说，在一定程度上可以减少信息丢失，因为它考虑了每组内样本的整体情况。
## 上采样
上采样是一种增加数字信号采样率的操作，通常涉及内插法。其目的是为了提高信号的分辨率或在需要更高采样率的场景中使用。常见的内插法有以下两种：
1. 零阶保持内插法：这种内插法的基本思想是在两个原始样本之间插入一个值，这个值保持与前一个原始样本的值相同。例如，对于一个原始采样率为$f_s$的数字信号，经过零阶保持内插法上采样后，采样率变为$2f_s$。在这个过程中，对于每一个原始样本，我们在它后面插入一个与它相同的值，从而实现采样率的增加。这种内插法简单易行，但因为插入的值与前一个样本的值相同，没有考虑到样本之间的变化趋势，可能会导致信号的波形出现阶梯状的不光滑现象。
2. 线性内插法：线性内插法是在两个原始样本之间插入一个值，这个值是根据两个原始样本的值通过线性关系计算出来的。同样以原始采样率为$f_s$的数字信号为例，经过线性内插法上采样后，采样率变为$2f_s$。在这个过程中，对于每一个原始样本$x[n]$，我们在它后面插入一个值$y[n]$，$y[n]$的计算方式是根据前一个样本$x[n - 1]$和当前样本$x[n]$通过线性关系计算出来的，即$$y[n]=(x[n - 1]+x[n])/2$$
3. 这种内插法相对零阶保持内插法来说，由于其考虑了样本之间的变化趋势，所以能使信号的波形更加光滑。
# 音频文件DSP
## 实现WAV文件的DSP技术
### 输入模块
输入模块的主要任务是读取音频文件的参数和信号。对于WAV文件，它首先要读取文件开头的RIFF、fmt等区块的信息（前文介绍），这些信息包含了音频文件的格式、采样率、声道数、量化位数等重要参数。然后根据这些参数，读取data区块中的音频信号数据。
### DSP模块
DSP模块是对读取的音频信号进行各种处理的核心部分。这里可以包括前面提到的各种基本运算、采样率转换等处理。例如，可以通过纯量乘法运算来调节音频文件的音量大小，通过加法/减法运算来混合或去除音频文件中的某些声音等。
### 输出模块 
输出模块的主要任务是保存处理后的音频文件。在完成对音频信号的各种处理后，需要将处理后的音频信号和相关参数按照WAV文件的格式重新组织并保存到新的文件中。