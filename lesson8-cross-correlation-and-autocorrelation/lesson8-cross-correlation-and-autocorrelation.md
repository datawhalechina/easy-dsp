# 前言
本章将要介绍两种与卷积类似的运算，互相关和自相关。互相关可以衡量两个信号之间的相似度，自相关则是衡量自己与自己的相似度，也就是周期性。本章讲解了这两种运算的方法和应用，并举出了具体的例子来帮助大家理解。
# 互相关
## 定义
互相关（Cross - correlation）是描述两个信号之间相似性随时间延迟变化的一种度量。对于两个离散时间信号($x[n]$)和($y[n]$)，它们的互相关函数$$R_{xy}[m]$$定义为$$R_{xy}[m]=\sum_{n = -\infty}^{\infty}x[n]y[n + m]$$（假设信号是能量有限信号）。

在连续时间情况下，对于两个信号$x(t)$和$y(t)$，互相关函数为$$R_{xy}(\tau)=\int_{-\infty}^{\infty}x(t)y(t+\tau)dt$$
它与卷积的区别在于，卷积是一种信号处理操作，计算方式为$$(x*y)[n]=\sum_{k = -\infty}^{\infty}x[k]y[n - k]$$（离散情况），互相关在信号的移位方式上有所不同，并且在物理意义上也有差异。

这个公式的含义是，要得到在时刻$t$的互相关结果$y(t)$，需要对所有可能的$\tau$值，将$x(\tau)$与$h(t + \tau)$相乘，然后在整个实数轴上（$-\infty$到$\infty$）对这些乘积进行积分。

对于数字信号，给定$x[n]$与$h[n]$，互相关$y[n]$的计算公式为：
$$y[n]=\sum_{k = -\infty}^{\infty}x[k]h[n + k]$$
这里是对所有可能的离散样本索引$k$，将$x[k]$与$h[n + k]$相乘，然后对这些乘积进行求和。

## 示例：计算给定两个数字信号的互相关结果
假设我们有两个数字信号：
数字信号$$x[n]$：$\{1, 2, 3, 2, 1\}$$（这里假设$n$从$0$到$4$）

数字信号$$h[n]$：$\{2, 1, 0, 1, 2\}$$（同样$n$从$0$到$4$）

我们来计算它们的互相关$$y[n]=x[n]\otimes h[n]$$
对于$n = 0$：
$$
\begin{align*}
y[0]&=\sum_{k = -\infty}^{\infty}x[k]h[0 + k]\\
&=x[0]h[0]+x[1]h[1]+x[2]h[2]+x[3]h[3]+x[4]h[4]\\
&=1\times2 + 2\times1 + 3\times0 + 2\times1 + 1\times2\\
&=2 + 2 + 0 + 2 + 2\\
&=8
\end{align*}
$$
对于$n = 1$：
$$
\begin{align*}
y[1]&=\sum_{k = -\infty}^{\infty}x[k]h[1 + k]\\
&=x[0]h[1]+x[1]h[2]+x[2]h[3]+x[3]h[4]+x[4]h[5]\\
&=1\times1 + 2\times0 + 3\times1 + 2\times2 + 1\times(\text{undefined})\\
&=1 + 0 + 3 + 4 + 0\\
&=8
\end{align*}
$$
因为$h[5]$在我们给定的$h[n]$定义中不存在（$n$只到$4$），所以该项视为$0$。
对于$n = 2$：
$$
\begin{align*}
y[2]&=\sum_{k = -\infty}^{\infty}x[k]h[2 + k]\\
&=x[0]h[2]+x[1]h[3]+x[2]h[4]+x[3]h[5]+x[4]h[6]\\
&=1\times0 + 2\times1 + 3\times2 + 2\times(\text{undefined}) + 1\times(\text{undefined})\\
&=0 + 2 + 6 + 0 + 0\\
&=8
\end{align*}
$$
对于$n = 3$：
$$
\begin{align*}
y[3]&=\sum_{k = -\infty}^{\infty}x[k]h[3 + k]\\
&=x[0]h[3]+x[1]h[4]+x[2]h[5]+x[3]h[6]+x[4]h[7]\\
&=1\times1 + 2\times2 + 3\times(\text{undefined}) + 2\times(\text{undefined}) + 1\times(\text{undefined})\\
&=1 + 4 + 0 + 0 + 0\\
&=5
\end{align*}
$$
对于$n = 4$：
$$
\begin{align*}
y[4]&=\sum_{k = -\infty}^{\infty}x[k]h[4 + k]\\
&=x[0]h[4]+x[1]h[5]+x[2]h[6]+x[3]h[7]+x[4]h[8]\\
&=1\times2 + 2\times(\text{undefined}) + 3\times(\text{undefined}) + 2\times(\text{undefined}) + 1\times(\text{undefined})\\
&=2 + 0 + 0 + 0 + 0\\
&=2
\end{align*}
$$
对于$n > 4$或$n < 0$，按照同样的方法计算，会发现$y[n]=0$（因为在这些情况下，涉及到的$h[n + k]$或$x[k]$会超出给定信号的定义范围，相应乘积视为$0$，求和后结果为$0$）。
所以，互相关结果$y[n]$为：
$$y[n]=\begin{cases}8, & n = 0, 1, 2 \\ 5, & n = 3 \\ 2, & n = 4 \\ 0, & \text{otherwise}\end{cases}$$
结果分析：从这个计算结果可以看出，在不同的延迟值$n$下，两个数字信号的互相关值有所不同。当$n = 0, 1, 2$时，互相关值相对较高且相等，这表明在这些延迟情况下，两个信号之间存在较强的关联性或相似性。而当$n = 3$和$n = 4$时，互相关值有所下降，说明随着延迟的增加，两个信号之间的关系逐渐变弱。通过这种互相关运算，我们可以更深入地了解两个信号之间的相互关系，比如在通信系统中，可以用于分析发送信号和接收信号之间的相关性，以检测信号传输过程中的变化或干扰等情况。
## 互相关的应用
互相关主要用于衡量两个信号之间的相似性。数字信号处理中，在模式识别、语音识别等领域，需要比较两个信号的相似程度。例如，在语音识别中，需要判断当前输入的语音片段与预定义的语音模板之间的相似性。

互相关函数的值可以反映信号之间的相似程度。如果两个信号完全相同，在没有时间延迟或者经过适当的时间对齐后，互相关函数在某些点会有较大的值。一般来说，互相关函数的峰值大小和形状也能提供关于信号相似性的信息。如果两个信号不相似，互相关函数的值会比较小，并且不会出现明显的峰值。例如，比较一段正常的语音信号和一段含有大量噪声的语音信号与标准语音模板的互相关，正常语音信号的互相关峰值会更明显，且数值较大。

例如，两个信号$x(t)$和$y(t)$是相同的信号，只是$y(t)$相对于$x(t)$有一个时间延迟$\tau_0$，即$$y(t)=x(t - \tau_0)$$ 互相关函数$$R_{xy}(\tau)$在$\tau = \tau_0$$时会出现峰值。

又比如，有一个原始信号$x[n]$和它经过延迟后的信号$y[n]=x[n - 5]$，计算它们的互相关函数$$R_{xy}[m]$$
会发现当$m = 5$时出现峰值，进一步地，通过这个峰值位置就可以估计出延迟时间。

在通信和控制系统中，为了了解信号经过系统或信道后的变化情况，需要对系统或信道进行识别和估计。例如，在无线通信中，信号在传输过程中会受到信道衰落和多径效应的影响，通过互相关可以估计信道的特性。

如果已知输入信号$x(t)$和经过系统后的输出信号$y(t)$，它们的互相关函数结合输入信号的自相关函数可以用于估计系统的脉冲响应。在一些简单的情况下，通过对互相关函数进行适当的处理可以得到系统对信号的影响方式，从而实现系统识别和信道估计的目的。
# 自相关
## 定义
自相关是针对单个函数或信号自身进行的一种相关性分析运算。
对于连续时间信号，给定函数$x(t)$，自相关$R_x(\tau)$定义为：
$$R_x(\tau)=\int_{-\infty}^{\infty}x^*(t)x(t+\tau)dt$$
这里的$x^*(t)$表示$x(t)$的共轭复数（如果$x(t)$是实函数，则$x^*(t)=x(t)$）。

对于数字信号，给定数字信号$x[n]$，自相关$R_xx[n]$定义为：
$$R_x[n]=\sum_{k = -\infty}^{\infty}x[k]x[k + n]$$
其中$\tau$（或$n$）为延迟。

自相关的本质是在不同延迟下考察信号自身的相似性，通过计算信号在不同时刻相对于自身的相关性，来挖掘信号的一些内在特征。
## 示例：计算给定数字信号的自相关结果
假设我们有数字信号$$x[n]$：$\{1, 2, 3, 2, 1\}$$（这里假设$n$从$0$到$4$）

我们来计算它的自相关$$R_x[n]=x[n]\times x[n + n]$$（这里简化写法，实际应按照定义公式计算）。

对于$n = 0$：
$$
\begin{align*}
R[0]&=\sum_{k = -\infty}^{\infty}x[k]x[k + 0]\\
&=x[0]x[0]+x[1]x[1]+x[2]x[2]+x[3]x[3]+x[4]x[4]\\
&=1\times1 + 2\times2 + 3\times3 + 2\times2 + 1\times1\\
&=1 + 4 + 9 + 4 + 1\\
&=19
\end{align*}
$$
对于$n = 1$：
$$
\begin{align*}
R[1]&=\sum_{k = -\infty}^{\infty}x[k]x[k + 1]\\
&=x[0]x[1]+x[1]x[2]+x[2]x[3]+x[3]x[4]+x[4]x[5]\\
&=1\times2 + 2\times3 + 3\times2 + 2\times1 + 1\times(\text{undefined})\\
&=2 + 6 + 6 + 2 + 0\\
&=16
\end{align*}
$$
因为$x[5]$在我们给定的$x[n]$定义中不存在（$n$只到\4$），所以该项视为$0$。
对于$n = 2$：
$$
\begin{align*}
R[2]&=\sum_{k = -\infty}^{\infty}x[k]x[k + 2]\\
&=x[0]x[2]+x[1]x[3]+x[2]x[4]+x[3]x[5]+x[4]x[6]\\
&=1\times3 + 2\times2 + 3\times1 + 2\times(\text{undefined}) + 1\times(\text{undefined})\\
&=3 + 4 + 3 + 0 + 0\\
&=10
\end{align*}
$$
对于$n > 2$或$n < 0$，按照同样的方法计算，会发现$R[n]=0$（因为在这些情况下，涉及到的$x[k + n]$或$x[k]$会超出给定信号的定义范围，相应乘积视为$0$，求和后结果为$0$）。
所以，自相关结果$R_xx[n]$为：
$$R_x[n]=\begin{cases}19, & n = 0 \\ 16, & n = 1 \\ 10, & n = 2 \\ 4,& \text{otherwise}\end{cases}$$
结果分析：

从这个计算结果可以看出，自相关值随着延迟$n$的变化而变化。当$n = 0$时，自相关值最大，这是因为此时是信号自身与自身完全重合的情况，所以相关性最强。

随着延迟$n$的增加，自相关值逐渐下降，这表明信号随着时间的推移，自身的相似性在逐渐降低。通过自相关运算，我们可以了解到信号的周期性等特征。例如，如果一个信号是周期性的，那么在其自相关结果中，会在周期的整数倍延迟处出现相对较高的自相关值，因为在这些延迟情况下，信号会与自身的某个周期部分重合，从而显示出较强的相关性。
## 自相关应用
自相关在信号处理领域有着广泛的应用，以下是一些常见的方面：
### 信号周期性检测
如前面所提到的，通过计算信号的自相关结果，可以很容易地检测信号是否具有周期性。如果在自相关结果中，在某些特定的延迟值处出现明显的峰值（即相对较高的自相关值），且这些峰值之间的间隔相对固定，那么就可以推断该信号具有周期性，并且这些峰值间隔就是信号的周期。例如，在音频处理中，对于一些具有明显周期性的乐器声音（如钢琴、小提琴等），通过计算其自相关，可以准确地确定其周期，进而对声音进行更深入的分析，比如分析其音色的形成与周期的关系等。
### 信号特征提取
自相关可以帮助提取信号的一些重要特征。除了周期性外，还可以反映信号的平稳性等特征。对于一个平稳信号，其自相关值随着延迟的增加会逐渐趋近于一个常数（如果是零均值的平稳信号，则趋近于零）。通过分析自相关结果中自相关值的变化趋势，可以判断信号是否平稳以及其平稳程度。此外，自相关还可以用于提取信号的能量分布特征。在计算自相关时，实际上是在对信号自身的能量在不同延迟下进行重新分配和统计，通过观察自相关结果中不同延迟处的自相关值大小，可以了解到信号能量在时间轴上的分布情况，这对于分析信号的特性和进行后续处理（如滤波、压缩等）都有着重要的意义。
### 信号噪声分析
在存在噪声的情况下，信号的自相关特性也会发生变化。通过计算信号在有噪声和无噪声情况下的自相关结果，可以分析噪声对信号的影响。一般来说，噪声是随机的，其自相关值在大多数情况下会趋近于零（对于一些特殊类型的噪声可能有不同的表现）。所以，当信号中加入噪声后，原本清晰的自相关结果（如周期性信号的自相关峰值等）可能会被模糊化。通过对比分析有噪声和无噪声时的自相关结果，可以评估噪声的强度以及对信号特性的影响，进而采取相应的措施（如滤波等）来处理噪声问题。
### 通信系统中的应用
在通信系统中，自相关有着重要的应用。例如，在同步检测中，通过计算接收信号的自相关，可以找到信号中的同步码元等标志性部分。因为同步码元通常具有特定的自相关特性（如在特定延迟处有唯一的峰值等），通过计算自相关并寻找这些特征，可以确定接收信号中同步码元的位置，从而实现信号的同步。此外，在信道估计中，自相关也可以用于分析信道的特性。通过对发送信号和接收信号的自相关结果进行对比分析，可以了解到信道对信号的影响，如信号在信道中传播时的衰减、时延等特性，进而对信道进行准确的估计，以便更好地进行通信系统的设计和优化。